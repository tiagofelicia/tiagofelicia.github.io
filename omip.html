<html lang="pt-PT">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
    <title>Futuros OMIP 2026: Preços da Eletricidade a Prazo | Tiago Felícia</title>
    <meta name="description" content="Consulte os valores dos contratos futuros do OMIP para Portugal e Espanha. Dados atualizados para 2026 do mercado a prazo de eletricidade (Diário, Mensal, Anual)." />

    <link rel="canonical" href="https://www.tiagofelicia.pt/omip.html" />
    
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Futuros da Eletricidade (OMIP): A tendência dos preços" />
    <meta property="og:description" content="Veja quanto o mercado espera que a eletricidade custe no futuro. Tabelas completas Portugal e Espanha." />
    <meta property="og:url" content="https://www.tiagofelicia.pt/omip.html" />
    <meta property="og:image" content="https://www.tiagofelicia.pt/images/social-share.jpg" />
    <meta property="og:locale" content="pt_PT" />

    <link rel="icon" type="image/png" href="/images/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/svg+xml" href="/images/favicon.svg" />
    <link rel="shortcut icon" href="/images/favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png" />
    <link rel="manifest" href="/images/site.webmanifest" />
    <link rel="stylesheet" href="style.css" />

    <script async src="https://www.googletagmanager.com/gtag/js?id=G-J4NWP00S4F"></script>
    <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-J4NWP00S4F'); </script>

    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "DataFeed",
      "name": "Preços Futuros Eletricidade OMIP",
      "description": "Cotações de fecho dos contratos de futuros de eletricidade para o MIBEL (Portugal e Espanha).",
      "provider": {
        "@type": "Organization",
        "name": "Tiago Felícia"
      }
    }
    </script>

    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "FAQPage",
      "mainEntity": [{
        "@type": "Question",
        "name": "O que é o OMIP e como difere do OMIE?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "O OMIP (Operador do Mercado Ibérico de Energia - Pólo Português) é a entidade que gere o mercado a prazo de eletricidade na Península Ibérica. Complementa o OMIE, que gere o mercado diário e intradiário (mercado "spot"). No OMIE, negoceiam-se os preços da eletricidade para entrega no dia seguinte. No OMIP, negoceiam-se contratos para entrega de eletricidade em períodos futuros (dias, semanas, meses, trimestres, anos)."
        }
      },{
        "@type": "Question",
        "name": "O que são os "Contratos Futuros" apresentados?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Contratos futuros são acordos para comprar ou vender eletricidade a um preço definido hoje, mas para entrega numa data ou período futuro específico. O Valor (€/MWh) apresentado para cada contrato (ex: FPB M Apr-26) reflete a expectativa do mercado, no momento da atualização dos dados, sobre qual será o preço médio da eletricidade durante esse período futuro (abril de 2026, neste exemplo)."
        }
      },{
        "@type": "Question",
        "name": "O que significam as diferentes descrições (Diários, Semanais, Mensais...)?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Os contratos estão agrupados pela duração do período de entrega a que se referem: Diários (D): Referem-se a um dia específico no futuro. Semanais (Wk): Referem-se a uma semana específica (identificada pelo número da semana e ano). O preço é a média esperada para essa semana. Mensais (M): Referem-se a um mês civil específico. Trimestrais (Q): Referem-se a um trimestre civil específico (Q1: Jan-Mar, Q2: Abr-Jun, Q3: Jul-Set, Q4: Out-Dez). Anuais (YR): Referem-se a um ano civil completo."
        }
      },{
        "@type": "Question",
        "name": "Para que servem estes preços? Quem os utiliza?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Os preços dos futuros OMIP são importantes porque: Funcionam como um indicador das expectativas do mercado sobre a evolução futura dos preços da eletricidade. São usados por produtores, comercializadores e grandes consumidores para gerir o risco de volatilidade dos preços, permitindo-lhes "fixar" custos ou receitas futuras. Servem de referência para a definição de preços em contratos de fornecimento de eletricidade a médio e longo prazo, incluindo algumas tarifas fixas oferecidas aos consumidores finais."
        }
      },{
        "@type": "Question",
        "name": "De onde vêm estes dados?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Os dados apresentados são extraídos automaticamente das informações publicadas pelo OMIP. A Data de Atualização indicada no topo da página corresponde à data da última atualização."
        }
      }]
    }
    </script>
    
    <style>
        .painel-header { text-align: center; margin-bottom: 20px; }
        .painel-header h1 { margin: 0 0 20px 0; font-size: 1.5em; color: #2c3e50; }
        .painel-header p { margin: 5px 0 0; font-size: 0.9em; color: #666; }
        .data-atualizacao { text-align: center; font-weight: bold; margin-bottom: 30px; font-size: 1.1em; }

        /* Grelha para as duas tabelas */
        .futures-grid {
            display: grid;
            grid-template-columns: 1fr 1fr; /* Duas colunas iguais */
            gap: 30px; /* Espaço entre tabelas */
            width: 95%;
            max-width: 1200px;
            margin: 20px auto;
        }
        @media (max-width: 900px) {
            .futures-grid {
                grid-template-columns: 1fr; /* Uma coluna em ecrãs menores */
            }
        }

        .table-container { width: 100%; overflow-x: auto; border: 1px solid #ddd; border-radius: 8px; background-color: white; }
        .futures-table { width: 100%; border-collapse: collapse; }
        .futures-table caption { font-size: 1.4em; font-weight: bold; padding: 10px; background-color: #f8f9fa; border-bottom: 1px solid #ddd; caption-side: top; text-align: center; }
        .futures-table th, .futures-table td { padding: 8px 12px; border-bottom: 1px solid #eee; text-align: center; white-space: nowrap; font-size: 1.1em; }
        .futures-table thead th { background-color: #343a40; color: white; position: sticky; top: 0; font-size: 1.2em; }
        .futures-table tbody tr:nth-child(even) { background-color: #f9f9f9; }
        .col-contrato { width: 25%; }
        .col-descricao { width: 50%; }
        .col-valor { width: 18%; text-align: center; font-weight: bold;}
        .col-variacao { width: 7%; text-align: center; }

        @media (max-width: 600px) {
            .futures-table th, .futures-table td { padding: 5px 6px; font-size: 0.85em; white-space: normal; }
            .futures-table thead th { font-size: 0.9em; }
            .futures-table caption { font-size: 1.1em; }
            .col-contrato { display: none; }
            .col-descricao { width: 70%; text-align: left; }
            .col-valor { width: 22%; }
            .col-variacao { width: 8%; }
        }

        /* Estilos para agrupar linhas por tipo */
        .futures-table tbody tr.tipo-header td {
            background-color: #e9ecef;
            font-weight: bold;
            font-size: 1.2em;
            text-align: center;
            border-top: 2px solid #ccc;
        }

        .link-section { text-align: center; margin: 30px auto; }
        .link-section p { font-family: monospace; font-size: 0.9em; color: #555; background-color: #e9ecef; padding: 8px 12px; border-radius: 4px; display: inline-block; margin: 0; }
        .content-support { max-width: 1200px; margin: 40px auto; padding: 0 15px; }

    </style>
</head>
<body>
<header>
    <div class="header-content"> 
        <div class="header-title-container"> 
            <a href="index.html"> 
                <img src="images/Logo_Tiago_Felicia.png" alt="Logótipo Tiago Felícia - Página Inicial" class="logo"> 
            </a> 
            <div class="brand-name">Tiago Felícia</div> 
        </div> 
        <p>Simuladores de tarifários de Eletricidade, Gás Natural e Autoconsumo</p> 
    </div>
</header>

<div id="menu-placeholder">
    <nav style="display:none;">
        <a href="eletricidade-tiagofelicia.html">Eletricidade</a>
        <a href="gas-natural-tiagofelicia.html">Gás</a>
        <a href="autoconsumo-tiagofelicia.html">Solar</a>
    </nav>
</div>

<main>
    <section id="omip-futures">
        <div class="painel-header">
            <h1>Eletricidade - Futuros OMIP</h1>
            <p>Valores dos contratos a prazo (€/MWh)</p>

        </div>

        <div class="futures-grid">
            <div class="table-group">
                 <div class="link-section">
                    <p>https://www.tiagofelicia.pt/omip.html</p>
                </div>
                <p class="data-atualizacao" style="margin: 8px 0 10px; font-size: 0.9em; color: #666; font-weight: normal;">Dados atualizados em: <span class="badge-data-omip">--/--/----</span></p>
                <div class="table-container">
                    <table id="tabela-omip-pt" class="futures-table">
                        <caption>Portugal - Futuros Eletricidade</caption>

                    <thead>
                        <tr>
                            <th class="col-contrato">Contrato</th>
                            <th class="col-descricao">Descrição</th>
                            <th class="col-valor">Valor<br><span style="font-size:0.75em; font-weight:normal;">(€/MWh)</span></th>
                            <th class="col-variacao">Var.</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td colspan="4" style="text-align: center; padding: 20px;">A carregar dados...</td></tr>
                    </tbody>
                </table>
            </div>

            </div> <div class="table-group">
                 <div class="link-section">
                     <p>https://www.tiagofelicia.pt/omip.html</p>
                 </div>
                <p class="data-atualizacao" style="margin: 8px 0 10px; font-size: 0.9em; color: #666; font-weight: normal;">Dados atualizados em: <span class="badge-data-omip">--/--/----</span></p>
                <div class="table-container">
                    <table id="tabela-omip-es" class="futures-table">
                         <caption>Espanha - Futuros Eletricidade</caption>
                    <thead>
                        <tr>
                            <th class="col-contrato">Contrato</th>
                            <th class="col-descricao">Descrição</th>
                            <th class="col-valor">Valor<br><span style="font-size:0.75em; font-weight:normal;">(€/MWh)</span></th>
                            <th class="col-variacao">Var.</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td colspan="4" style="text-align: center; padding: 20px;">A carregar dados...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </section>

    <section id="faq-omip-futures">
        <article class="content-support" style="margin-top: 30px;">
            <h2>Compreender os Futuros OMIP</h2>

            <details class="faq-item">
                <summary><strong>O que é o OMIP e como difere do OMIE?</strong></summary>
                <div class="faq-content">
                    <p>O <strong>OMIP (Operador do Mercado Ibérico de Energia - Pólo Português)</strong> é a entidade que gere o mercado a prazo de eletricidade na Península Ibérica. Complementa o <strong>OMIE</strong>, que gere o mercado diário e intradiário (mercado "spot").</p>
                    <ul>
                        <li>No <strong>OMIE</strong>, negoceiam-se os preços da eletricidade para entrega no dia seguinte.</li>
                        <li>No <strong>OMIP</strong>, negoceiam-se contratos para entrega de eletricidade em períodos futuros (dias, semanas, meses, trimestres, anos).</li>
                    </ul>
                </div>
            </details>

            <details class="faq-item">
                <summary><strong>O que são os "Contratos Futuros" apresentados?</strong></summary>
                <div class="faq-content">
                    <p>Contratos futuros são acordos para comprar ou vender eletricidade a um preço definido hoje, mas para entrega numa data ou período futuro específico.</p>
                    <p>O <strong>Valor (€/MWh)</strong> apresentado para cada contrato (ex: FPB M Apr-26) reflete a <strong>expectativa do mercado</strong>, no momento da atualização dos dados, sobre qual será o preço médio da eletricidade durante esse período futuro (abril de 2026, neste exemplo).</p>
                </div>
            </details>

            <details class="faq-item">
                <summary><strong>O que significam as diferentes descrições (Diários, Semanais, Mensais...)?</strong></summary>
                <div class="faq-content">
                    <p>Os contratos estão agrupados pela duração do período de entrega a que se referem:</p>
                    <ul>
                        <li><strong>Diários (D):</strong> Referem-se a um dia específico no futuro.</li>
                        <li><strong>Semanais (Wk):</strong> Referem-se a uma semana específica (identificada pelo número da semana e ano). O preço é a média esperada para essa semana.</li>
                        <li><strong>Mensais (M):</strong> Referem-se a um mês civil específico.</li>
                        <li><strong>Trimestrais (Q):</strong> Referem-se a um trimestre civil específico (Q1: Jan-Mar, Q2: Abr-Jun, Q3: Jul-Set, Q4: Out-Dez).</li>
                        <li><strong>Anuais (YR):</strong> Referem-se a um ano civil completo.</li>
                    </ul>
                </div>
            </details>

            <details class="faq-item">
                <summary><strong>Para que servem estes preços? Quem os utiliza?</strong></summary>
                <div class="faq-content">
                    <p>Os preços dos futuros OMIP são importantes porque:</p>
                    <ul>
                        <li>Funcionam como um <strong>indicador das expectativas</strong> do mercado sobre a evolução futura dos preços da eletricidade.</li>
                        <li>São usados por <strong>produtores, comercializadores e grandes consumidores</strong> para gerir o risco de volatilidade dos preços, permitindo-lhes "fixar" custos ou receitas futuras.</li>
                        <li>Servem de <strong>referência</strong> para a definição de preços em contratos de fornecimento de eletricidade a médio e longo prazo, incluindo algumas tarifas fixas oferecidas aos consumidores finais.</li>
                    </ul>
                </div>
            </details>
            
            <details class="faq-item">
                <summary><strong>Estes são os preços que vou pagar na minha fatura?</strong></summary>
                <div class="faq-content">
                    <p><strong>Não diretamente.</strong> Os consumidores (residenciais ou pequenos negócios) pagam as tarifas definidas pelos seus comercializadores, que já incluem outras componentes (custos de rede, taxas, margem do comercializador).</p>
                    <p>No entanto, os preços negociados no OMIP influenciam a forma como os comercializadores compram energia e definem as suas estratégias de preço, especialmente para tarifas fixas ou de longo prazo. Por isso, podem ter um impacto indireto nas ofertas disponíveis no mercado.</p>
                </div>
            </details>

            <details class="faq-item">
                <summary><strong>De onde vêm estes dados?</strong></summary>
                <div class="faq-content">
                    <p>Os dados apresentados são extraídos automaticamente das informações publicadas pelo OMIP. A <strong>Data de Atualização</strong> indicada no topo da página corresponde à data da última atualização.</p>
                </div>
            </details>
        </article>
    </section>
</main>

<div id="footer-placeholder"></div>

<script>
document.addEventListener('DOMContentLoaded', function () {

    const csvUrl = "https://raw.githubusercontent.com/tiagofelicia/tiagofelicia.github.io/main/data/omie_dados_atuais.csv";
    const tabelaOmipPtBody = document.querySelector("#tabela-omip-pt tbody");
    const tabelaOmipEsBody = document.querySelector("#tabela-omip-es tbody");

    // --- Funções Auxiliares ---
    function formatarValor(valor, casasDecimais = 2) {
        if (valor === null || typeof valor === 'undefined' || isNaN(valor)) { return '--,--'; }
        return valor.toFixed(casasDecimais).replace('.', ',');
    }

    // ===== Ler dia da semana pelo código do contrato =====
    function obterDiaPeloCodigo(contratoStr) {
        if (!contratoStr) return "";

        // Mapeamento das siglas do OMIP (Inglês -> Português)
        const mapaDias = {
            'Mo': 'Segunda-feira',
            'Tu': 'Terça-feira',
            'We': 'Quarta-feira',
            'Th': 'Quinta-feira',
            'Fr': 'Sexta-feira',
            'Sa': 'Sábado',
            'Su': 'Domingo'
        };

        // Procura a sigla no contrato (ex: procura " D Tu" em "FPB D Tu09Dec-25")
        // Usamos o espaço antes e depois (ou número) para garantir que não apanhamos letras aleatórias
        for (const [sigla, nomePT] of Object.entries(mapaDias)) {
            if (contratoStr.includes(` D ${sigla}`)) {
                return nomePT;
            }
        }
        return "";
    }
    // ==================================================================

    function parseCSV(text) {
        const tabelas = text.split('\nTABELA_');

        function parseTabelaSimples(raw, tipo) {
             if (!raw) return tipo === 'obj' ? {} : [];
             const lines = raw.trim().split('\n');
             lines.shift(); 
             if (lines.length < 1) return tipo === 'obj' ? {} : [];
             const headerLine = lines.shift();
             if (!headerLine) return tipo === 'obj' ? {} : [];
             const headers = headerLine.split(',').map(h => h.trim().replace(/^\uFEFF/, ''));

             if (tipo === 'obj') { 
                 const obj = {}; const keyHeaderIndex = headers.findIndex(h => h.toLowerCase() === 'chave'); const valueHeaderIndex = headers.findIndex(h => h.toLowerCase() === 'valor'); if (keyHeaderIndex === -1 || valueHeaderIndex === -1) { return {}; } lines.forEach(line => { const values = line.split(','); if (values.length > Math.max(keyHeaderIndex, valueHeaderIndex)) { const key = values[keyHeaderIndex]?.trim(); const value = values[valueHeaderIndex]?.trim(); if (key) { obj[key] = value; } } }); return obj;
             } else { 
                 const data = lines.map(line => {
                     const row = {};
                     const values = line.match(/(".*?"|[^",]+)(?=\s*,|\s*$)/g) || [];
                     headers.forEach((header, index) => {
                         let value = (values.length > index && values[index]) ? values[index].trim() : '';
                         if (value.startsWith('"') && value.endsWith('"')) { value = value.substring(1, value.length - 1); }
                         if (header.toLowerCase() === 'valor' && value !== "") { row[header] = parseFloat(value); } else { row[header] = value; }
                     });
                     if (row['Contrato']) { if (row['Contrato'].includes(' D ')) row.Tipo = 'Diários'; else if (row['Contrato'].includes(' Wk')) row.Tipo = 'Semanais'; else if (row['Contrato'].includes(' M ')) row.Tipo = 'Mensais'; else if (row['Contrato'].includes(' Q')) row.Tipo = 'Trimestrais'; else if (row['Contrato'].includes(' YR-')) row.Tipo = 'Anuais'; else row.Tipo = 'Outros'; }
                     else { row.Tipo = 'Inválido'; }
                     // Normalizar Variacao (formato: direção:diff, ex: up:+1.50)
                     const validDirs = ['up','down','equal','new'];
                     const varDir = (row['Variacao'] || '').split(':')[0];
                     if (!validDirs.includes(varDir)) row['Variacao'] = 'new:0';
                     return row;
                 });
                 return data;
             }
        }
        
        const atualizacoes = parseTabelaSimples(tabelas.find(t => t.startsWith("ATUALIZACOES")), 'obj');
        const futurosPT = parseTabelaSimples(tabelas.find(t => t.startsWith("FUTUROS_PT")), 'array');
        const futurosES = parseTabelaSimples(tabelas.find(t => t.startsWith("FUTUROS_ES")), 'array');
        return { atualizacoes, futurosPT, futurosES };
    }

    function buildFuturesTableHTML(futuros) {
        let tableHTML = '';
        const tipos = ['Diários', 'Semanais', 'Mensais', 'Trimestrais', 'Anuais'];
        const futurosAgrupados = tipos.reduce((acc, tipo) => {
            acc[tipo] = futuros.filter(f => f.Tipo === tipo);
            return acc;
        }, {});

        const omipLink = 'https://www.omip.pt/pt';

        function renderVariacao(raw) {
            const [dir, diff] = (raw || 'new:0').split(':');
            const diffNum = parseFloat(diff) || 0;
            const diffStr = diffNum !== 0 ? ` (${diffNum > 0 ? '+' : ''}${diffNum.toFixed(2)} €/MWh)` : '';

            const configs = {
                'up':    { icon: '▲', color: '#28a745', label: `Subiu${diffStr}` },
                'down':  { icon: '▼', color: '#dc3545', label: `Desceu${diffStr}` },
                'equal': { icon: '=', color: '#b8860b', label: 'Sem variação' },
                'new':   { icon: '—', color: '#888',    label: 'Novo contrato' },
            };
            const c = configs[dir] || configs['new'];
            return `<a href="${omipLink}" target="_blank" rel="noopener" title="${c.label} — ver OMIP" style="color:${c.color}; font-size:1.1em; text-decoration:none; font-weight:bold;">${c.icon}</a>`;
        }

        tipos.forEach(tipo => {
            const fData = futurosAgrupados[tipo];
            if (fData.length > 0) {
                tableHTML += `<tr class="tipo-header"><td colspan="4">${tipo}</td></tr>`;
                fData.forEach(futuro => {
                    let descricao = futuro['Descricao'] || '';
                    let contrato = futuro['Contrato'] || '';
                    const variacao = futuro['Variacao'] || 'new:0';
                    const icone = renderVariacao(variacao);

                    if (tipo === 'Diários') {
                        const diaSemana = obterDiaPeloCodigo(contrato);
                        if (diaSemana) {
                            descricao += ` <span style="font-size: 0.85em; color: #666; font-weight: normal;">(${diaSemana})</span>`;
                        }
                    }

                    tableHTML += `<tr>`;
                    tableHTML += `<td class="col-contrato">${contrato}</td>`;
                    tableHTML += `<td class="col-descricao">${descricao}</td>`;
                    tableHTML += `<td class="col-valor">${futuro['Valor'] !== undefined ? formatarValor(futuro['Valor']) : ''}</td>`;
                    tableHTML += `<td class="col-variacao">${icone}</td>`;
                    tableHTML += `</tr>`;
                });
            }
        });
        return tableHTML || '<tr><td colspan="4" style="text-align: center;">Não foram encontrados dados.</td></tr>';
    }

    fetch(csvUrl)
        .then(response => { if (!response.ok) throw new Error(`Erro ${response.status} ao carregar CSV.`); return response.text(); })
        .then(csvText => {
            const { atualizacoes, futurosPT, futurosES } = parseCSV(csvText);
            const dataAtualizacao = atualizacoes.Data_Valores_OMIP || "Erro";
            document.querySelectorAll('.badge-data-omip').forEach(el => { el.textContent = dataAtualizacao; });

            // Calcular a data do dia seguinte à atualização (formato DD/MM/YYYY)
            function diaSeguinte(dataStr) {
                if (!dataStr || !dataStr.includes('/')) return null;
                const [dia, mes, ano] = dataStr.split('/');
                const d = new Date(Date.UTC(parseInt(ano), parseInt(mes) - 1, parseInt(dia)));
                d.setUTCDate(d.getUTCDate() + 1);
                return `${String(d.getUTCDate()).padStart(2,'0')}/${String(d.getUTCMonth()+1).padStart(2,'0')}/${d.getUTCFullYear()}`;
            }
            const dataSeguinte = diaSeguinte(dataAtualizacao);

            // Filtrar contratos Diários cuja Descricao seja o dia seguinte
            function filtrarFuturos(futuros) {
                return futuros.filter(f => !(f.Tipo === 'Diários' && f.Descricao === dataSeguinte));
            }

            tabelaOmipPtBody.innerHTML = buildFuturesTableHTML(filtrarFuturos(futurosPT));
            tabelaOmipEsBody.innerHTML = buildFuturesTableHTML(filtrarFuturos(futurosES));
        })
        .catch(error => {
            console.error('Falha ao carregar ou processar os dados OMIP:', error);
            const errorMsg = '<tr><td colspan="3" style="text-align: center; color: red;">Erro ao carregar os dados.</td></tr>';
            tabelaOmipPtBody.innerHTML = errorMsg;
            tabelaOmipEsBody.innerHTML = errorMsg;
            spanDataAtualizacao.textContent = "Erro";
        });

    fetch('menu.html').then(response => response.text()).then(data => { document.getElementById('menu-placeholder').innerHTML = data; }).catch(error => console.error('Erro menu:', error));
    fetch('footer.html').then(response => response.text()).then(data => { document.getElementById('footer-placeholder').innerHTML = data; }).catch(error => console.error('Erro footer:', error));
});
</script>

</body>

</html>
